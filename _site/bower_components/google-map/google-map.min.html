<link rel=import href=../polymer/polymer.html><link rel=import href=../google-apis/google-apis.min.html><polymer-element name=google-map-marker attributes=icon><template><style>:host{display:none}</style></template><script>!function(){function t(t){this.latitude=t.latLng.lat(),this.longitude=t.latLng.lng()}function i(){this.draggable?this.dragHandler_=google.maps.event.addListener(this.marker,"dragend",t.bind(this)):(google.maps.event.removeListener(this.dragHandler_),this.dragHandler_=null)}Polymer({marker:null,map:null,info:null,icon:null,publish:{longitude:{value:null,reflect:!0},latitude:{value:null,reflect:!0}},observe:{latitude:"updatePosition",longitude:"updatePosition"},detached:function(){this.marker.setMap(null)},attached:function(){this.marker&&this.marker.setMap(this.map)},updatePosition:function(){this.marker&&null!=this.latitude&&null!=this.longitude&&this.marker.setPosition({lat:parseFloat(this.latitude),lng:parseFloat(this.longitude)})},iconChanged:function(){this.marker&&this.marker.setIcon(this.icon)},mapChanged:function(){this.map&&this.map instanceof google.maps.Map&&this.mapReady()},contentChanged:function(){this.onMutation(this,this.contentChanged);var t=this.innerHTML;t?(this.info||(this.info=new google.maps.InfoWindow,this.infoHandler_=google.maps.event.addListener(this.marker,"click",function(){this.info.open(this.map,this.marker)}.bind(this))),this.info.setContent(t)):this.info&&(google.maps.event.removeListener(this.infoHandler_),this.info=null)},mapReady:function(){this.marker=new google.maps.Marker({map:this.map,position:new google.maps.LatLng(this.latitude,this.longitude),title:this.title,draggable:this.draggable,visible:!this.hidden,icon:this.icon}),this.contentChanged(),i.bind(this)()},attributeChanged:function(t){if(this.marker)switch(t){case"hidden":this.marker.setVisible(!this.hidden);break;case"draggable":this.marker.setDraggable(this.draggable),i.bind(this)();break;case"title":this.marker.setTitle(this.title)}}})}();</script></polymer-element><polymer-element name=google-map attributes="apiKey latitude longitude zoom showCenterMarker version map mapType disableDefaultUI fitToMarkers zoomable styles maxZoom minZoom libraries"><template><style>:host{position:relative}#map{position:absolute;top:0;right:0;bottom:0;left:0}</style><google-maps-api apikey={{apiKey}} version={{version}} on-api-load={{mapApiLoaded}} libraries={{libraries}}></google-maps-api><div id=map></div><content id=markers select=google-map-marker></content></template><script>Polymer({apiKey:null,latitude:37.77493,libraries:"places",longitude:-122.41942,zoom:10,showCenterMarker:!1,mapType:"roadmap",version:"3.exp",disableDefaultUI:!1,fitToMarkers:!1,zoomable:!0,styles:[{stylers:[{visibility:"on"},{hue:"#008076"},{saturation:-75}]}],maxZoom:null,minZoom:null,observe:{latitude:"updateCenter",longitude:"updateCenter"},created:function(){this.markers=[]},attached:function(){this.resize()},mapApiLoaded:function(){this.map=new google.maps.Map(this.$.map,this.getMapOptions()),this.updateCenter(),this.updateMarkers(),this.addMapListeners(),this.fire("google-map-ready")},getMapOptions:function(){var t={zoom:this.zoom,mapTypeId:this.mapType,disableDefaultUI:this.disableDefaultUI,disableDoubleClickZoom:!this.zoomable,scrollwheel:this.zoomable,styles:this.styles,maxZoom:Number(this.maxZoom),minZoom:Number(this.minZoom)};return null!=this.getAttribute("draggable")&&(t.draggable=this.draggable),t},updateMarkers:function(){if(this.markers=Array.prototype.slice.call(this.$.markers.getDistributedNodes()),this.centerMarker&&this.markers.push(this.centerMarker),this.onMutation(this,this.updateMarkers),this.markers.length&&this.map){for(var t,e=0;t=this.markers[e];++e)t.map=this.map;this.fitToMarkers&&this.fitToMarkersChanged()}},clear:function(){for(var t,e=0;t=this.markers[e];++e)t.marker.setMap(null)},resize:function(){this.map&&(google.maps.event.trigger(this.map,"resize"),this.updateCenter())},updateCenter:function(){if(this.map){if("number"!=typeof this.latitude||isNaN(this.latitude))throw new TypeError("latitude must be a number");if("number"!=typeof this.longitude||isNaN(this.longitude))throw new TypeError("longitude must be a number");var t=new google.maps.LatLng(this.latitude,this.longitude),e=this.map.getCenter();e?(e=new google.maps.LatLng(e.lat(),e.lng()),e.equals(t)||this.map.panTo(t)):this.map.setCenter(t),this.showCenterMarkerChanged()}},zoomChanged:function(){this.map&&this.map.setZoom(Number(this.zoom))},maxZoomChanged:function(){this.map&&this.map.setOptions({maxZoom:Number(this.maxZoom)})},minZoomChanged:function(){this.map&&this.map.setOptions({minZoom:Number(this.minZoom)})},mapTypeChanged:function(){this.map&&this.map.setMapTypeId(this.mapType)},showCenterMarkerChanged:function(){if(this.map){if(this.showCenterMarker){this.centerMarker||(this.centerMarker=document.createElement("google-map-marker"));var t=this.map.getCenter();this.centerMarker.latitude=t.lat(),this.centerMarker.longitude=t.lng()}else this.centerMarker&&(this.centerMarker.marker.setMap(null),this.centerMarker=null);this.updateMarkers()}},disableDefaultUIChanged:function(){this.map&&this.map.setOptions({disableDefaultUI:this.disableDefaultUI})},zoomableChanged:function(){this.map&&this.map.setOptions({disableDoubleClickZoom:!this.zoomable,scrollwheel:this.zoomable})},attributeChanged:function(t){if(this.map)switch(t){case"draggable":this.map.setOptions({draggable:this.draggable})}},fitToMarkersChanged:function(){if(this.map&&this.fitToMarkers){for(var t,e=new google.maps.LatLngBounds,i=0;t=this.markers[i];++i)e.extend(new google.maps.LatLng(t.latitude,t.longitude));this.markers.length>1&&this.map.fitBounds(e),this.map.setCenter(e.getCenter())}},addMapListeners:function(){google.maps.event.addListener(this.map,"center_changed",function(){var t=this.map.getCenter();this.latitude=t.lat(),this.longitude=t.lng()}.bind(this)),google.maps.event.addListener(this.map,"zoom_changed",function(){this.zoom=this.map.getZoom()}.bind(this))}});</script></polymer-element>